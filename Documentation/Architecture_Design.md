# π›οΈ ArcCore ν”„λ΅μ νΈ μ•„ν‚¤ν…μ² μ„¤κ³„

## 1. κ°μ”

`ArcCore`λ” C++ κΈ°λ°μ κ³ μ„±λ¥ MMORPG κ²μ„ μ„λ²„ ν¬νΈν΄λ¦¬μ¤ ν”„λ΅μ νΈμ…λ‹λ‹¤. λ³Έ λ¬Έμ„λ” `ArcCore` μ„λ²„μ μ•„ν‚¤ν…μ²λ¥Ό μ •μν•λ©°, μ•μ •μ μΈ λ™μ‹ μ ‘μ† μ²λ¦¬μ™€ ν¨μ¨μ μΈ κ²μ„ λ°μ΄ν„° κ΄€λ¦¬λ¥Ό μ„ν• **μ΄λ²¤νΈ λ“λ¦¬λΈ μ•„ν‚¤ν…μ²**μ— μ¤‘μ μ„ λ‘΅λ‹λ‹¤. μ΄λ” μ»΄ν¬λ„νΈ κ°„μ λ‚®μ€ κ²°ν•©λ„μ™€ λ†’μ€ ν™•μ¥μ„±μ„ λ©ν‘λ΅ ν•©λ‹λ‹¤.

## 2. μ„¤κ³„ λ©ν‘ λ° μ›μΉ™

* **κ³ μ„±λ¥**: IOCP κΈ°λ° λΉ„λ™κΈ° I/O λ¨λΈκ³Ό μ΄λ²¤νΈ λ²„μ¤λ¥Ό ν™μ©ν•μ—¬ λ‚®μ€ μ‘λ‹µ μ‹κ°„μ„ λ³΄μ¥ν•©λ‹λ‹¤.
* **μ•μ •μ„±**: κ²¬κ³ ν• μ—λ¬ μ²λ¦¬ λ° λ΅κΉ…μ„ ν†µν•΄ μ•μ •μ μΈ μ„λΉ„μ¤λ¥Ό μ κ³µν•κ³ , μ΄λ²¤νΈ κΈ°λ°μΌλ΅ μ¥μ•  μ „νλ¥Ό μµμ†ν™”ν•©λ‹λ‹¤.
* **ν™•μ¥μ„±**: λμ¨ν•κ² κ²°ν•©λ μ»΄ν¬λ„νΈ κµ¬μ΅°λ΅ κΈ°λ¥ μ¶”κ°€ λ° λ³€κ²½μ΄ μ©μ΄ν•λ©° μ‹μ¤ν… ν™•μ¥μ΄ μ μ—°ν•©λ‹λ‹¤.
* **μ μ§€λ³΄μμ„±**: κ° λ¨λ“μ λ…ν™•ν• μ—­ν•  λ¶„λ¦¬μ™€ μ΄λ²¤νΈ μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ μ½”λ“ κ°€λ…μ„± λ° μ μ§€λ³΄μμ„±μ„ λ†’μ…λ‹λ‹¤.
* **λ‹¨μΌ μ±…μ„ μ›μΉ™ (SRP)**: κ° λ¨λ“μ€ ν•λ‚μ λ…ν™•ν• μ±…μ„λ§μ„ κ°€μ§‘λ‹λ‹¤.

## 3. μ‹μ¤ν… μ•„ν‚¤ν…μ² κ°μ”

`ArcCore` μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ μ”μ²­ μ²λ¦¬, κ²μ„ λ΅μ§ μν–‰, λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤. λ¨λ“  λ‚΄λ¶€ μ»΄ν¬λ„νΈ κ°„ ν†µμ‹ μ€ `Common` λ¨λ“ λ‚΄μ **μ΄λ²¤νΈ λ²„μ¤(Event Bus)** λ¥Ό ν†µν•΄ λΉ„λ™κΈ°μ μΌλ΅ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.

```mermaid
graph TD
    subgraph External_Systems
        Client[Unity Client]
        Database[(MySQL Database)]
    end

    subgraph ArcCore_GameServer
        NetworkModule[Network Module]
        GameLogicModule[Game Logic Module]
        GameDBModule[GameDB Module]

        subgraph CommonModule[Common Module]
            EventBus(Event Bus)
        end

        PacketProtocolModule[Packet Protocol Module]
    end

    Client <-->|Packets| NetworkModule
    Database <-->|DB Operations| GameDBModule

    NetworkModule -- Publishes Client Packets --> EventBus
    GameLogicModule -- Publishes Game Events & Packet Send Requests & DB Requests --> EventBus
    GameDBModule -- Publishes DB Results --> EventBus

    EventBus -- Dispatches Client Packets & Game Events & DB Results --> GameLogicModule
    EventBus -- Dispatches DB Requests --> GameDBModule
    EventBus -- Dispatches Packet Send Requests --> NetworkModule

    NetworkModule -.->|Uses Packet Protocol| PacketProtocolModule
    GameLogicModule -.->|Uses Packet Protocol| PacketProtocolModule
```

## 4. μ£Όμ” μ»΄ν¬λ„νΈ λ° μ—­ν• 

κ° λ¨λ“μ€ λ…ν™•ν• μ±…μ„μ„ κ°€μ§€λ©° EventBusλ¥Ό ν†µν•΄ μ†ν†µν•©λ‹λ‹¤.

### 4.1. `MainServer` (Executable)

* **μ—­ν• **: μ„λ²„μ μ§„μ…μ . λ¨λ“  λΌμ΄λΈλ¬λ¦¬(Common, Network, PacketProtocol, GameDB, GameLogic)λ¥Ό λ§ν¬ν•κ³ , μ„λ²„ μ΄κΈ°ν™” λ° λ©”μΈ λ£¨ν”„λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.

### 4.2. `Common` (Static Library)

* **μ—­ν• **: μ„λ²„ μ „λ°μ— κ±Έμ³ κ³µν†µμ μΌλ΅ μ‚¬μ©λλ” κΈ°λ° μ ν‹Έλ¦¬ν‹° λ° **μ΄λ²¤νΈ μ‹μ¤ν…μ ν•µμ‹¬ κµ¬μ„± μ”μ†**λ¥Ό μ κ³µν•©λ‹λ‹¤. λ¨λ“  λ‹¤λ¥Έ μ„λ²„ λ¨λ“μ€ `Common` λ¨λ“μ΄ μ κ³µν•λ” κΈ°λ¥μ„ μ•”μ‹μ μΌλ΅ ν™μ©ν•©λ‹λ‹¤.
* **μ£Όμ” κΈ°λ¥**:
    * **EventBus**: μ¤‘μ•™ μ§‘μ¤‘μ‹ μ΄λ²¤νΈ λ°ν–‰/κµ¬λ… ν—λΈ (μ¤λ λ“-μ•μ „ν• μ΄λ²¤νΈ ν ν¬ν•¨).
    * **BaseEvent**: λ¨λ“  κµ¬μ²΄μ μΈ μ΄λ²¤νΈμ μ¶”μƒ κΈ°λ³Έ ν΄λμ¤/μΈν„°νμ΄μ¤.
    * λ©”λ¨λ¦¬ ν’€, μ¤λ λ“-μ•μ „ μλ£κµ¬μ΅°, λ΅κΉ… μ‹μ¤ν…, νƒ€μ΄λ¨Έ κ΄€λ¦¬ λ“±.

### 4.3. `Network` (Static Library)

* **μ—­ν• **: IOCP κΈ°λ°μ λΉ„λ™κΈ° λ„¤νΈμ›ν¬ ν†µμ‹ μ„ μ „λ‹΄ν•©λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈ μ„Έμ… κ΄€λ¦¬ λ° ν¨ν‚· μ†΅μμ‹ μ„ μ²λ¦¬ν•©λ‹λ‹¤.
* **μ£Όμ” κΈ°λ¥**:
    * IOCP λ° Winsock API λν•‘, μ„Έμ… κ΄€λ¦¬.
    * μμ‹ λ ν¨ν‚·μ„ `PacketProtocol`μ— μ •μλ **ν΄λΌμ΄μ–ΈνΈ ν¨ν‚· μμ‹  μ΄λ²¤νΈ**λ΅ λ³€ν™ν•μ—¬ `EventBus`μ— λ°ν–‰.
    * `PacketProtocol`μ— μ •μλ **λ„¤νΈμ›ν¬ μ „μ†΅ μ”μ²­ μ΄λ²¤νΈ**λ¥Ό κµ¬λ…ν•μ—¬ ν¨ν‚· μ§λ ¬ν™” ν›„ ν΄λΌμ΄μ–ΈνΈμ— μ „μ†΅.
    * **μƒμ„ λ„λ©”μΈ λ¨λ“(GameLogic, GameDB)μ— μ§μ ‘ μμ΅΄ν•μ§€ μ•μµλ‹λ‹¤.**

### 4.4. `PacketProtocol` (Static Library)

* **μ—­ν• **: Google Protobufλ¥Ό μ‚¬μ©ν• ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ ν†µμ‹  ν¨ν‚· κµ¬μ΅°λ¥Ό μ •μν•κ³ , **λ„¤νΈμ›ν¬ μ†΅μμ‹  κ΄€λ ¨ λ²”μ© μ΄λ²¤νΈ ν΄λμ¤λ¥Ό μ •μ**ν•©λ‹λ‹¤. μ΄ λ¨λ“μ€ `Common` λ¨λ“μ `BaseEvent`λ¥Ό μ‚¬μ©ν•μ§€λ§, λ‹¤μ΄μ–΄κ·Έλ¨μ—μ„λ” μ‹κ°μ  κ°„κ²°μ„±μ„ μ„ν•΄ μ§μ ‘μ μΈ `Uses` ν™”μ‚΄ν‘λ” μƒλµν•©λ‹λ‹¤.
* **μ£Όμ” κΈ°λ¥**:
    * `.proto` νμΌ μ •μ λ° Protobuf C++ μ½”λ“ μλ™ μƒμ„±.
    * `Network`μ™€ `GameLogic` κ°„μ λμ¨ν• κ²°ν•©μ„ μ„ν• `ClientPacketReceivedEvent<PacketType>` λ° `NetworkSendRequestEvent<PacketType>` μ •μ.

### 4.5. `GameDB` (Static Library)

* **μ—­ν• **: MySQL λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™μ„ λ‹΄λ‹Ήν•λ©°, κ²μ„ λ°μ΄ν„°μ μμ†μ„± κ΄€λ¦¬λ¥Ό μ„ν• μ¶”μƒν™” κ³„μΈµμ„ μ κ³µν•©λ‹λ‹¤.
* **μ£Όμ” κΈ°λ¥**:
    * DB μ»¤λ„¥μ… ν’€, λΉ„λ™κΈ° μΏΌλ¦¬ μ‹μ¤ν….
    * `EventBus`λ΅λ¶€ν„° DB μΏΌλ¦¬ μ”μ²­ μ΄λ²¤νΈλ¥Ό κµ¬λ…ν•μ—¬ DB μΏΌλ¦¬ μν–‰.
    * μΏΌλ¦¬ μ™„λ£ ν›„ κ²°κ³Όλ¥Ό λ‹΄μ€ μ΄λ²¤νΈ(e.g., `LoginDBResultEvent`)λ¥Ό `EventBus`μ— λ°ν–‰.

### 4.6. `GameLogic` (Static Library)

* **μ—­ν• **: μ„λ²„μ ν•µμ‹¬ κ²μ„ κ·μΉ™κ³Ό μƒνƒ λ³€ν™”λ¥Ό μ²λ¦¬ν•©λ‹λ‹¤. `EventBus`λ¥Ό ν†µν•΄ λ‹¤μ–‘ν• μ΄λ²¤νΈλ¥Ό κµ¬λ…ν•κ³  κ²μ„ λ΅μ§μ„ μν–‰ν•λ©°, κ²μ„ μƒνƒ λ³€ν™”λ¥Ό μ΄λ²¤νΈλ΅ λ°ν–‰ν•©λ‹λ‹¤.
* **μ£Όμ” κΈ°λ¥**:
    * `PacketProtocol`μ `ClientPacketReceivedEvent`λ¥Ό κµ¬λ…ν•μ—¬ μ²λ¦¬ν•λ©°, μ΄λ¥Ό **κ²μ„ λ„λ©”μΈ μ΄λ²¤νΈλ΅ λ³€ν™ν•μ—¬ μ¬λ°ν–‰** (μ: `C_MOVE_PACKET` -> `PlayerMoveRequestEvent`).
    * κ²μ„ λ΅μ§ μν–‰ ν›„ `PlayerMovedEvent`μ™€ κ°™μ€ λ„λ©”μΈ μ΄λ²¤νΈ λ°ν–‰.
    * ν΄λΌμ΄μ–ΈνΈμ— μ‘λ‹µ μ‹, `PacketProtocol`μ `NetworkSendRequestEvent`λ¥Ό μƒμ„±ν•μ—¬ `EventBus`μ— λ°ν–‰.
    * μ „ν¬, μΈλ²¤ν† λ¦¬, μ±„ν…, λ¬μ¤ν„°, NPC, ν€μ¤νΈ λ“± λ‹¤μ–‘ν• κ²μ„ μ‹μ¤ν… κµ¬ν„.

## 5. μ΄λ²¤νΈ λ²„μ¤ (ν•µμ‹¬ μ”μ†)

* **μ—­ν• **: `Common` λ¨λ“ λ‚΄μ— κµ¬ν„λ `ArcCore` μ•„ν‚¤ν…μ²μ μ¤‘μ‹¬μ¶•μΌλ΅, λ¨λ“  μ»΄ν¬λ„νΈ κ°„μ λΉ„λ™κΈ° ν†µμ‹ μ„ λ‹΄λ‹Ήν•©λ‹λ‹¤. μ΄λ²¤νΈλ¥Ό λ°ν–‰ν•κ³ , ν•΄λ‹Ή μ΄λ²¤νΈλ¥Ό κµ¬λ…ν•λ” λ¨λ“  ν•Έλ“¤λ¬μ—κ² μ „λ‹¬ν•©λ‹λ‹¤.
* **κµ¬ν„**: μ‹±κΈ€ν†¤ ν¨ν„΄μΌλ΅ κµ¬ν„λλ©°, λ‚΄λ¶€μ— μ¤λ λ“-μ•μ „ν• μ΄λ²¤νΈ νλ¥Ό μ μ§€ν•μ—¬ λ°ν–‰/μ†λΉ„λ¥Ό λ¶„λ¦¬ν•©λ‹λ‹¤. `BaseEvent` νƒ€μ…μ„ κΈ°λ°μΌλ΅ λ™μ‘ν•μ—¬ κµ¬μ²΄μ μΈ μ΄λ²¤νΈ νƒ€μ…μ—λ” μμ΅΄ν•μ§€ μ•μµλ‹λ‹¤.

## 6. λ°μ΄ν„° νλ¦„ (ν”λ μ΄μ–΄ μ΄λ™)

1.  **ν΄λΌμ΄μ–ΈνΈ -> Network**: Unity ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ™ ν¨ν‚·(`C_MOVE_PACKET`)μ„ μ„λ²„λ΅ μ „μ†΅.
2.  **Network λ¨λ“**: ν¨ν‚· μμ‹  λ° μ—­μ§λ ¬ν™” ν›„, `PacketProtocol`μ— μ •μλ **ν΄λΌμ΄μ–ΈνΈ ν¨ν‚· μμ‹  μ΄λ²¤νΈ**λ¥Ό μƒμ„±ν•μ—¬ `EventBus`μ— λ°ν–‰.
3.  **EventBus -> GameLogic**: ν΄λΌμ΄μ–ΈνΈ ν¨ν‚· μμ‹  μ΄λ²¤νΈλ¥Ό `GameLogic`μ ν•Έλ“¤λ¬μ—κ² μ „λ‹¬. `GameLogic`μ€ μ΄λ²¤νΈλ¥Ό λ°›μ•„ **κ²μ„ λ„λ©”μΈ μ΄λ²¤νΈλ΅ λ³€ν™** (μ: `PlayerMoveRequestEvent`)ν•μ—¬ λ‹¤μ‹ `EventBus`μ— μ¬λ°ν–‰.
4.  **GameLogic λ¨λ“**:
    * `PlayerMoveRequestEvent`μ™€ κ°™μ€ κ²μ„ λ„λ©”μΈ μ΄λ²¤νΈλ¥Ό κµ¬λ…ν•μ—¬ μ²λ¦¬. (μ„ νƒμ μΌλ΅ μ„±λ¥ μµμ ν™”λ¥Ό μ„ν•΄ μ§μ ‘ νΈμ¶ κ°€λ¥)
    * μ΄λ™ μ ν¨μ„± κ²€μ‚¬ λ° μ„μΉ μ—…λ°μ΄νΈ μν–‰.
    * μ΄λ™ μ™„λ£ ν›„ `PlayerMovedEvent`λ¥Ό `EventBus`μ— λ°ν–‰.
    * ν΄λΌμ΄μ–ΈνΈμ— μ‘λ‹µμ„ μ„ν•΄ μ‘λ‹µ ν¨ν‚·(`S_MOVE_PACKET`)μ„ μƒμ„±ν•κ³ , `PacketProtocol`μ— μ •μλ **λ„¤νΈμ›ν¬ μ „μ†΅ μ”μ²­ μ΄λ²¤νΈ**λ¥Ό μƒμ„±ν•μ—¬ `EventBus`μ— λ°ν–‰.
5.  **EventBus -> Network**: λ„¤νΈμ›ν¬ μ „μ†΅ μ”μ²­ μ΄λ²¤νΈλ¥Ό `Network` λ¨λ“λ΅ μ „λ‹¬.
6.  **Network λ¨λ“**: λ„¤νΈμ›ν¬ μ „μ†΅ μ”μ²­ μ΄λ²¤νΈλ¥Ό κµ¬λ…. λ‚΄λ¶€ ν¨ν‚·μ„ μ§λ ¬ν™”ν•μ—¬ ν•΄λ‹Ή ν΄λΌμ΄μ–ΈνΈ μ„Έμ…μ— μ „μ†΅.
7.  **GameDB λ¨λ“ (μ„ νƒμ )**: `GameLogic`μ΄ `SavePlayerLocationRequestEvent`λ¥Ό λ°ν–‰ν•λ©΄, `GameDB`κ°€ κµ¬λ…ν•μ—¬ DB μ‘μ—… μν–‰ ν›„ `PlayerLocationSavedEvent` λ°ν–‰.

## 7. μ¤λ λ“ λ¨λΈ

`ArcCore` μ„λ²„λ” IOCP κΈ°λ°μ λΉ„λ™κΈ° I/Oμ™€ μ΄λ²¤νΈ κΈ°λ° μ¤λ λ“ μ²λ¦¬λ¥Ό κ²°ν•©ν• λ¨λΈμ„ μ‚¬μ©ν•©λ‹λ‹¤.

* **I/O μ¤λ λ“**: `Network` λ¨λ“μ—μ„ IOCP μ΄λ²¤νΈλ¥Ό μ²λ¦¬ν•κ³ , μμ‹  λ°μ΄ν„°λ¥Ό ν¨ν‚·ν™”ν•μ—¬ `EventBus`μ— λ°ν–‰.
* **λ©”μΈ κ²μ„ λ΅μ§ μ¤λ λ“**: λ€λ¶€λ¶„μ κ²μ„ λ΅μ§ μ΄λ²¤νΈλ¥Ό `EventBus`λ΅λ¶€ν„° κµ¬λ…ν•μ—¬ μμ°¨μ μΌλ΅ μ²λ¦¬, κ²μ„ μƒνƒ μΌκ΄€μ„± μ μ§€.
* **DB μ¤λ λ“ ν’€**: `GameDB` λ¨λ“μ—μ„ DB μ”μ²­ μ΄λ²¤νΈλ¥Ό κµ¬λ…ν•μ—¬ λΉ„λ™κΈ° DB μ‘μ—… μν–‰ ν›„ DB κ²°κ³Ό μ΄λ²¤νΈλ¥Ό λ°ν–‰.

## 8. λΉλ“ λ° λ°°ν¬ μ•„ν‚¤ν…μ²

* **vcpkg**: μ™Έλ¶€ λΌμ΄λΈλ¬λ¦¬(spdlog, Protobuf, MySQL Connector λ“±) μμ΅΄μ„±μ„ `vcpkg.json`μΌλ΅ κ΄€λ¦¬.
* **Visual Studio Solution**: λ¨λ“  μ„λ²„ ν”„λ΅μ νΈ ν†µν•© κ΄€λ¦¬ λ° λΉλ“.
* **CI/CD (ν–¥ν›„)**: GitHub Actions λ“±μ„ ν†µν• μλ™ λΉλ“, ν…μ¤νΈ, λ°°ν¬ νμ΄ν”„λΌμΈ κµ¬μ¶• κ³ λ ¤.